{% extends "base.html" %}

{% block title %}Find and Manage Friends{% endblock %}


{% block content %}
<section id="friends-and-requests" class="min-h-screen flex flex-col md:flex-row justify-center gap-20 items-start pt-20 px-8">
    <!-- Friends -->
    <div class="flex flex-col items-center w-full">
        <h2 class="text-2xl font-bold mb-6">Friends</h2>

        <!-- Search Bar -->
        <div class="mb-6 w-80">
            <form action="{{ url_for('main.manage_friends') }}" method="GET" class="flex items-center">
                <input type="text" name="search" placeholder="Search by name or email" class="border p-2 w-full rounded-l-lg">
                <button type="submit" class="bg-blue-500 text-white p-2 rounded-r-lg">Search</button>
            </form>
        </div>

        <!-- Friends List (scrollable) -->
        <div class="flex flex-col w-80 bg-white border-4 border-gray-300 rounded-2xl p-6 shadow-md overflow-y-auto max-h-96">
            {% for friend in friends %}
            <div class="flex justify-between items-center mb-4 hover:bg-gray-100 p-2 rounded-lg group relative">
                <div>
                    <p class="font-bold">{{ friend.first_name }} {{ friend.last_name }}</p>
                    <p class="text-sm text-gray-500">{{ friend.email }}</p>
                </div>
                <button class="text-xl text-gray-500 group-hover:text-red-500" onclick="confirmRemove({{ friend.id }})">
                    <i class="fas fa-times"></i>
                </button>
                <div class="absolute top-10 left-1/2 -translate-x-1/2 bg-white border-2 border-gray-300 rounded-lg px-4 py-2 text-xs hidden group-hover:block shadow-md">
                    Remove Friend
                </div>
            </div>

            <!-- Hidden form to trigger the POST request for each friend -->
            <form id="remove-friend-form-{{ friend.id }}" action="{{ url_for('main.remove_friend', user_id=friend.id) }}" method="POST" style="display: none;">
                <!-- CSRF Token -->
                {{ forms[friend.id].hidden_tag() }}
                <button type="submit" id="submit-remove-btn-{{ friend.id }}">Remove Friend</button>
            </form>

            {% endfor %}
        </div>
    </div>

    <!-- Confirmation Popup (Hidden by default) -->
    <div id="confirm-modal" class="fixed inset-0 flex justify-center items-center bg-gray-600 bg-opacity-10 hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm w-full relative z-10">
            <p class="text-lg mb-4">Are you sure you want to remove this friend?</p>
            <div class="flex justify-between">
                <button id="confirm-remove-btn" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-400 transition">Yes, remove</button>
                <button id="cancel-remove-btn" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-400 transition">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        function confirmRemove(friendId) {
            // Show the confirmation modal
            document.getElementById('confirm-modal').classList.remove('hidden');
    
            // Handle the confirmation action
            document.getElementById('confirm-remove-btn').onclick = function() {
                // Set the form action to the correct URL with the friend ID
                var form = document.getElementById('remove-friend-form-' + friendId);
                form.action = '/friend/remove/' + friendId; // Ensure the correct URL
    
                // Submit the form (this sends the POST request)
                form.submit();
            };
    
            // Close the modal if cancel is clicked
            document.getElementById('cancel-remove-btn').onclick = function() {
                document.getElementById('confirm-modal').classList.add('hidden');
            };
        }
    </script>
</section>
{% endblock %}
